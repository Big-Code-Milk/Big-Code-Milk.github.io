# 2020_0617 - 看的進度太慢了只好回家也看

## 此教學 ng cli 版本為 1.7.1、ng 版本為5.2.6、node 9.5.0，目前 ng cli 最新版本為 10.0.0 / 2020.06.17

* web search - Chocolatey

( Windows )套件管理器 可以一次大量安裝速度非常快

* cmd - npm i -g @angular/cli

安裝 Angular Command-Line Interface

* cmd - ng -v

確認版本與是否安裝完成

* VSCode - Angular Extension Pack

保哥出品必屬精品

* cmd - mkdir fileName

創建資料夾

* cmd - fileName>dir

資料夾詳細內容

* cmd - ng new projectName

第一次安裝會執行 nvm init 時間較久

* npm start

會執行 ng serve 命令開啟小型伺服器

* cmd - ctrl+c

终止程序的执行

* cmd - code .

使用 vscode 開啟此資料夾

* angular-cli.json

ng cli 6 設定檔更名

* .editorconfig

編輯器設定檔

* .gitignore

忽略版控設定檔

* package.json -> scripts

設定 angular 會用到的命令腳本

* protractor.conf.js

end to end testing 的設定檔

* tsconfig.json

Typtscript 設定檔

* tslint.json

tslint (檢查程式碼品質) 規則設定檔

* node_modules.file

npm packages module

* e2e.file

存放 End to End 測試檔

* sre.file

source code 存放處，內部資料結構依照 ng 官網的 style guide 指引

* sre.file > app.file

應用程式主檔

* sre.file > index.html

SPA 應用程式唯一進入點

* sre.file > style.css

主要 global style

* sre.file > main.ts

主要 global ts 進入點，ng 官方建議使用 typescript 開發，會去找 app.module，再去找 app.component 作為根模組與根元件與根模板、根樣式表、根單元測試檔

* sre.file > assets.file

資產靜態檔案 js library、jq、css、img...

* sre.file > assets.file > .gitkeep

保持在空資料夾進入版控的檔案

* sre.file > environments.file

環境變數，包含 prod 版本的 build，與開發時期的版本

* sre.file > favicon.ico

瀏覽器 icon

* sre.file > polyfills.ts

支援舊版本的加強模組，內部註解有寫使用時機與需要安裝的套件

* sre.file > test.ts

單元測試 karma.conf.js 測試檔

* sre.file > tsconfig.app.json

繼承上一層 tsconfig.json 可以額外針對 app.file 內的 ts 寫一些定義

* sre.file > tsconfig.spec.json

單元測試設定檔

* sre.file > tsconfig.d.ts

額外的 ts 的型別定義，例如要將 jq 引入可在此設定一些全域變數， `declare var $: any;`

---

vscode - f1 控制命令所有功能

vscode - ctrl+~ 開啟命令視窗

vscode - 目錄視窗斜體字是檔案呈現預覽模式

vscode - 最底下藍條，為一些特殊功能，最重要的是編輯錯誤或異常程式碼時左下角會顯示驚嘆號或叉叉。點下後會出現錯誤提示列表可以進行更詳細功能 debug 。

---

## 目的：應用程式開發，由 Google 主導並由社群共同餐與框架發展

ng1 = ngJS != ng2+

ng2+ 以上版本皆相容架構都一樣透過命令 ng update 即可無痛升級，不同的是要稍微改一下路徑或 npm 安裝相依 package。

---

## 優勢

### 跨平台

PWA - Progressive Web Apps (Angular Mobile Toolkit)

Desktop Apps - 搭配 Electron 跨 OS ( Windows / Mac / Linux )

Native Apps - ( lonic Native / NativeScript / React Native (ng 可以將 view 抽離) ) 跨平台原生應用程式

### 速度與效能

AOT 將元件範本預先編譯 JS

Universal SSR 首頁伺服器渲染，支援(Node.js / .NET / PHP ...)

Code Splitting 延遲載入，透過元件路由機制，使用者只載入需要的原始碼

偵測變更比 ng1 快 10 倍

更小 library size

範本編譯：支援預先編譯

渲染速度比 ng1 快 5 倍 ( render & re-render )

### 生產力提升

更簡潔的語法 比 ng1 移除 40+ directives

Angury

更清晰的專案結構與可維護性

Templates

ng cli

ide

### 完整開發體驗

Testing： karma 執行單元測試、protractor執行 E2E 測試。

Animation： API 處理動畫。

Accessibility： ARIA-enabled 元件 a11y 測試基礎架構可及性應用程式

---

### ng 官方建議開發語言 TypeScript / Dart

es5 > es 2015 > es 2016 > es 2017 > TypeScript2 超集合 皆可編譯建置為 JS

所以學 TS 並不會很厲害，真的要學的是 es5 ~ es2017+...

<https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html>

<https://www.typescriptlang.org/play/index.html?ssl=1&ssc=1&pln=2&pc=22#code/MYGwhgzhAEDKAuBXAJgUwHb2gbwFDQOgDNEQQA5MAW1QC5oJ4AnAS3QHMBufQ4Ae3SMmiYPD5MAFAAdEAIxAtgxFk0aUa9IW3YAaaDPmLoVFsmQhUASXQt4LMCE3NtegwqXg11Og2ccAlDg8hITwABYsEAB0JGTqqNAAvMqq8PHQANTQAEQ5mcam5lY2dg75ublZnmne3CEAvriNuGzwqExEYMAJAArtEAJBIUQqXhq+rBx1hNXxTpNcTbi4JOiiLIPsTKiobZJS-QL0faoCgXgh20hM6DkAEqhkfHqV+ofoMaM1NOV5WQenD6zWpLXAWLCICDtJLQdCoADucCQaEwEmyACkwHDsi8ALJRHE5ACqUKY2X83FwyD4wEQNEwUVkfGQAE8om0AB7wADCAjamBhWx2ewkkPaFKAA>

---

## NG 應用程式組成

模組 AppModule 包含許多 (元件 AppCompontent、ChildCompontent、ServicesCompontent、PipeCompontent...)。用於封裝元件

## ng 頁面組成

元件 AppCompontent 包含 (樣板+樣式)

![img](/img/ng1.png)

以往 jQ 都是直接操作 DOM 但 ng 進入一個頁面基本上只有 script 再藉由 js 將一個個 module 、 compontent 渲染出來，可以更專注於處理頁面商業邏輯與可維護性提高。

---

## ng cli 原理

cmd - npm start

cmd - ng serve 透過 webpack build bundle 的程式碼

打開 url 右鍵顯示原始碼會看到 body 只包含 app root directive 根元件與引入剛剛 bundle 的 js 檔案

啟動流程後根元件會被動態插入 DOM，這時使用 F12 進入 dev loop 即可看到。

但 index.html 裡面並沒有這些 bundle 的內容？ 其實 ng serve 這句指令同時也動態的修改了 index.html

接著下一個重點是，js 從哪開始從哪匯入呢？ main.ts 內載入環境變數後啟動模組，按 f12 進入到 app.module.ts

會看到宣告此 app.module 類型為 class 且有被 export 出來，透過 directive 宣告此類別為 @NgModule

@NgModule 內 parameter 參數包含像是

declarations 宣告與 view 有關的原件

imports 用來匯入這個模組會用到的其他模組

providers 註冊一些服務的提供者

bootstrap 啟動根元件 app component 按 f12 進入 app.component.ts

可以看到此 app.component 類型也是個 class 且有範例屬性參數，且透過 directive 宣告此類別為 @Component

@Component 內 parameter 參數包含像是

selector 選取器在網頁中找到一個同樣搜尋邏輯(標籤/類別/ID)的標籤，並把標籤內容修改為此元件執行後的結果。預設的 tslint package 會根據 ng guide 在寫錯時報錯，預設希望以標籤選擇器編寫。

templateUrl 指這個元件的 HTML Template 所在之處。可以寫 inline。

styleUrls 指這個元件的 CSS 所在之處。可以寫 inline。且預設不會與其他元件衝突。

---

## ng cli 應用

cmd - ng generate component 元件名稱。

cmd 會顯示 e.g. 建置 四個檔案分別是 (元件 ts、元件 css、元件 html template、測試 spec ts)、更新 一個檔案 module 的 import 引入與 declarations 宣告。

module 引入後，如要顯示這個新元件，只要將選擇器 tag 名稱，插入根模板內即可渲染出來。

cmd - ng generate -h 顯示目前 ng 版本所有可以生成的元件類型。

action 對著 templateUrl 按 alt+o 可以開啟 目標位置檔案。

如要移除元件必須要手動移除包含 file 與引入的 code。

速簡寫指令 cmd - ng g c 元件名稱。

---

## ng 靜態檔案加入

.angular-cli.json > apps 所有應用程式都註冊在這裡

在 assets 補上需要加入的靜態 fileName

## 靜態網頁轉為 ng 應用程式

SRP 只有 index.html 擁有 head tag 所以需要將靜態網頁的內容分開搬移，

需要注意到的是 index.html > head > `<base href="/">` 可以決定整個 Url 預設是以什麼為基礎，必須保留不可覆蓋。

必須將複製過來的 head meta data 至於 base tag 之下以面遇到有檔案找不到的狀況。

ctrl+e 可以直接搜尋文件名稱不必從目錄翻找。

接著將 body 之間的 html tag 置入 app root template 中，

報錯只要開啟 dev tool Console 觀看進行 debug 即可。

## 建置發行部屬

cmd - ng build 會將 ng app build 至 dist 轉為純前端 html css js 與一些靜態檔案的包裹，放上 web server 可直接執行。

f1 wrap 可以切換自動換行。

cmd - ng build --prod 可以進一步將檔案包壓縮至最小

dir fileName 查詢檔案大小

[直接在終端機輸入其他 shell 名字即可直接切換 e.g. cmd](https://medium.com/@jackaly9527/%E7%9A%AE%E6%AF%9B%E7%AD%86%E8%A8%98-%E5%A6%82%E4%BD%95%E5%9C%A8vs-code%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%A8%AEshell%E6%96%BC%E7%B5%82%E7%AB%AF%E6%A9%9F%E4%B8%8A-f89ce1e59fea)

---

## ng 升級至新版

* cmd - ng update

修改 package.json 套件版本，接著 npm update

* cmd - npm list -g --depth=0

全域觀看 packages 第一層的資訊

* npm outdated -g

全域查詢 packages 是否是最新版本

<https://update.angular.io/>

最好兩三個禮拜更新一次，避免後續累積太多技術債，且也能體驗到最新版本的內容。

---

## 資料繫結

* 內嵌 (interpolation)

{{property}}

單向把值從 component 元件內傳遞至 template。位置可以在 Tag Text 也可以在 Attribute value

* 屬性 (Property Binding)

[property]='statement'

[DOM property 與 HTML Attribute 是不太一樣的](https://www.w3cplus.com/javascript/dom-attributes-and-properties.html)，HTML5 擴充 data-Attribute，這時綁定自定義 HTML Attribute 會報錯。

dev tool > Elements > Properties 並不會有自定義的 data-Attribute ，而會是原始 tag 的 HTML Attribute。需要再擴充前加上 attr.data-Attribute 才能正確綁定。

<https://codertw.com/%E5%89%8D%E7%AB%AF%E9%96%8B%E7%99%BC/26913/#outline__1>

* 事件 (Event Binding)

(event)='someMethod($event)'

* 雙向 (Two-way Binding)

[(ngModel)]='property'

---

f1 format 或 shift+alt+f 資料格式化
